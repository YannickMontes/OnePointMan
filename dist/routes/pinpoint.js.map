{"version":3,"sources":["../../routes/pinpoint.js"],"names":["express","require","router","Router","db","squelb","squel","useFlavour","sender","post","req","res","toCreate","iduser","body","idgroup","pinlg","pinlt","description","daterdv","Date","setDate","getDate","dateexpiration","query","insert","into","set","parseInt","toISOString","returning","toString","one","then","row","response","idpinpoint","sendResponse","SUCCESS_STATUS","catch","console","log","e","BAD_REQUEST","status","message","toDelete","delete","from","where","module","exports"],"mappings":"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","file":"pinpoint.js","sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst db = require('../connection');\r\nconst squelb = require('squel');\r\nconst squel = squelb.useFlavour('postgres');\r\n\r\nconst sender = require('../sender');\r\n\r\nrouter.post('/createpinpoint/', function (req, res) {\r\n\r\n    let toCreate = {\r\n        iduser: req.body.iduser,\r\n        idgroup: req.body.idgroup,\r\n        pinlg: req.body.pinlg,\r\n        pinlt: req.body.pinlt,\r\n        description: req.body.description,\r\n        daterdv: req.body.daterdv,\r\n    };\r\n\r\n    let daterdv = new Date(toCreate.daterdv);\r\n    daterdv.setDate(daterdv.getDate());\r\n    let dateexpiration = new Date(toCreate.daterdv);\r\n    dateexpiration.setDate(dateexpiration.getDate() + 1);\r\n\r\n    let query = squel.insert()\r\n        .into('public.\"PINPOINT\"')\r\n        .set('idcreator', parseInt(toCreate.iduser, 10))\r\n        .set('idgroup', parseInt(toCreate.idgroup, 10))\r\n        .set('pinlt', toCreate.pinlt, 10)\r\n        .set('pinlg', toCreate.pinlg, 10)\r\n        .set('description', toCreate.description)\r\n        .set('daterdv', daterdv.toISOString())\r\n        .set('dateexpiration', dateexpiration.toISOString())\r\n        .returning('idpinpoint')\r\n        .toString();\r\n\r\n    db.one(query)\r\n        .then((row) => {\r\n            let response = {\r\n                idpinpoint: row.idpinpoint\r\n            };\r\n            sender.sendResponse(sender.SUCCESS_STATUS, response, res)\r\n        })\r\n        .catch(e => {\r\n            console.log(e);\r\n            sender.sendResponse(sender.BAD_REQUEST, {status: 'fail', message: 'Error while creating pinpoint'}, res);\r\n        })\r\n});\r\n\r\nrouter.post('/deletepinpoint/', function (req, res) {\r\n\r\n    let toDelete = {\r\n        iduser: req.body.iduser,\r\n        idgroup: req.body.idgroup,\r\n        idpinpoint: req.body.idpinpoint,\r\n    };\r\n\r\n    let query = squel.delete()\r\n        .from('public.\"PINPOINT\"')\r\n        //.where('idcreator = ?', parseInt(toDelete.iduser)) C mieux que nimporte qui puisse supprimer\r\n        .where('idgroup = ?', parseInt(toDelete.idgroup))\r\n        .where('idpinpoint = ?', parseInt(toDelete.idpinpoint))\r\n        .toString();\r\n\r\n    db.query(query)\r\n        .then(() => {\r\n            sender.sendResponse(sender.SUCCESS_STATUS, {status: 'success', message: 'Pinpoint deleted'}, res)\r\n        })\r\n        .catch(e => {\r\n            console.log(e);\r\n            sender.sendResponse(sender.BAD_REQUEST, {status: 'fail', message: 'Error while deleting pinpoint'}, res);\r\n        })\r\n\r\n});\r\n\r\nmodule.exports = router;\r\n"]}