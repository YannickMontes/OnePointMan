{"version":3,"sources":["../../routes/drawing.js"],"names":["express","require","router","Router","db","squelb","squel","useFlavour","sender","get","req","res","next","post","console","log","toCreate","idcreator","body","iduser","idgroup","description","zoom","nelt","nelg","swlt","swlg","img","toString","query","one","then","row","response","status","iddrawing","sendResponse","SUCCESS_STATUS","catch","e","BAD_REQUEST","message","toDelete","update","table","set","where","none","module","exports"],"mappings":"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","file":"drawing.js","sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst db = require('../connection');\r\nconst squelb = require('squel');\r\nconst squel = squelb.useFlavour('postgres');\r\nconst sender = require('../sender');\r\n\r\n\r\n\r\nrouter.get('/', function(req, res, next) {\r\n\r\n});\r\n\r\nrouter.post('/createdrawing', function(req,res){\r\n    console.log(\"YOOOOOOOOOOOO\");\r\n    let toCreate = {\r\n        idcreator: req.body.iduser,\r\n        idgroup: req.body.idgroup,\r\n        description: req.body.description,\r\n        zoom: req.body.zoom,\r\n        nelt: req.body.nelt,\r\n        nelg: req.body.nelg,\r\n        swlt: req.body.swlt,\r\n        swlg: req.body.swlg,\r\n        img: req.body.img\r\n    };\r\n\r\n    console.log(toCreate.img.toString());\r\n    /*let query = squel.insert()\r\n        .into('public.\"DRAWING\"')\r\n        .set('idcreator', toCreate.idcreator)\r\n        .set('idgroup', toCreate.idgroup)\r\n        .set('zoom', toCreate.zoom)\r\n        .set('description', toCreate.description)\r\n        .set('drawinglt', toCreate.lt)\r\n        .set('drawinglg', toCreate.lg)\r\n        .set('img', toCreate.img)\r\n        .returning('iddrawing')\r\n        .toString();*/\r\n\r\n    let query = 'INSERT INTO public.\"DRAWING\" (idcreator, idgroup, zoom, description, nelt, nelg, swlt, swlg, img)' +\r\n        ' VALUES(' + toCreate.idcreator + ',' + toCreate.idgroup + ',' + toCreate.zoom + ',\\'' + toCreate.description\r\n        + '\\',' + toCreate.nelt + ',' + toCreate.nelg + ',' + toCreate.swlt + ',' + toCreate.swlg +\r\n        ', decode(\\'' + toCreate.img + '\\', \\'base64\\')) RETURNING iddrawing';\r\n\r\n    console.log(\"query \" + query);\r\n    db.one(query)\r\n        .then((row)=>{\r\n            let response = {\r\n                status: 'success',\r\n                iddrawing : row.iddrawing\r\n            };\r\n            sender.sendResponse(sender.SUCCESS_STATUS, response, res)\r\n        })\r\n        .catch(e => {\r\n            console.log(e);\r\n            sender.sendResponse(sender.BAD_REQUEST, {status: 'fail',message:'Error while creating drawing'}, res);\r\n        })\r\n});\r\n\r\n//Ce serait peut etre mieux de le supprimer carrément? plutôt que de le set inactif\r\nrouter.post('/deletedrawing', function(req,res){\r\n   let toDelete = {\r\n       iddrawing: req.body.iddrawing\r\n   };\r\n\r\n   let query = squel.update()\r\n       .table('public.\"DRAWING\"')\r\n       .set('actif', false)\r\n       .where('iddrawing = ?', toDelete.iddrawing)\r\n       .toString();\r\n    db.none(query)\r\n        .then(()=>{\r\n            let response = {\r\n                status : 'success',\r\n                message:'Drawing deleted successfully'\r\n            };\r\n            sender.sendResponse(sender.SUCCESS_STATUS, response, res)\r\n        })\r\n        .catch(e=>{\r\n            sender.sendResponse(sender.BAD_REQUEST, {status:'fail', message:'Error while deleting drawing'}, res);\r\n            console.log(e);\r\n        })\r\n});\r\n\r\nmodule.exports = router;\r\n"]}